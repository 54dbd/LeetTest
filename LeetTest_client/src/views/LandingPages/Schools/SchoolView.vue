<script setup>
// example components
import image from "@/assets/img/city-profile.jpg";
import DefaultNavbar from "@/examples/navbars/NavbarDefault.vue";
import { reqGetSchoolList, reqSearchSchool } from "@/api";
import MaterialInput from "@/components/MaterialInput.vue";
import MarkDown from "@/components/MarkDown/MarkDown.vue";
import Header from "@/examples/Header.vue";
</script>

<template>
  <div class="container position-sticky z-index-sticky top-0">
    <div class="row">
      <div class="col-12">
        <DefaultNavbar :sticky="true" />
      </div>
    </div>
  </div>

  <Header>
    <div
      class="page-header min-height-200"
      :style="{ backgroundImage: `url(${image})` }"
      loading="lazy"
    >
      <span class="mask bg-gradient-dark opacity-8"></span>
    </div>
  </Header>

  <el-row :gutter="20">
    <el-col :span="20" :offset="2">
      <el-row style="line-height: 50px; margin-left: 30px; align-items: flex-start">
        <MaterialInput
          class="input-group-dynamic mt-4"
          icon="search"
          type="text"
          placeholder="请输入内容"
          v-model="keyWord"
          style="width: 15rem;"
          
        ></MaterialInput>
      </el-row>
      <div>
        <el-col class="elRow">
          <el-empty :image-size="200" v-if="total === 0"></el-empty>
          <el-col class="elCol" v-for="school in schoolList" :key="school.sid">
            <el-card shadow="hover" class="elCard" v-loading="loading">
              <img
                :src="school.badgeImg"
                referrerpolicy="no-referrer"
                alt="校徽"
              />
              <router-link
                :to="{
                  path: '/schoolDetail',
                  query: {
                    sid: school.sid,
                  },
                }"
              >
                {{ school.sname }}
              </router-link>
              <div>
                <MarkDown :text="school.shortIntroduction" />
              </div>
            </el-card>
          </el-col>
          <el-row>
            <el-pagination
              background
              layout="prev, pager, next"
              :page-size="pageParam.size"
              :current-page="pageParam.current"
              :pager-count="5"
              @current-change="currentChange"
              :total="total"
            >
            </el-pagination>
          </el-row>
        </el-col>
      </div>
    </el-col>
  </el-row>
</template>

<script>
export default {
  name: "Schools",
  components: {
    MarkDown,
  },
  data() {
    return {
      schoolList: [],
      pageParam: {
        current: 1,
        size: 5,
      },
      // 总页数
      pages: 0,
      // 总条数
      total: 0,
      keyWord: "",
      loading: true,
    };
  },
  methods: {
    async getSchoolList(pageParam) {
      const result = await reqGetSchoolList(pageParam);
      if (result.data.code === 200) {
        this.schoolList = result.data.data.schoolVoList;
        this.pages = result.data.data.pages;
        this.total = result.data.data.total;
        this.loading = false;
      } else {
        this.$message.error("系统异常~ " + result.data.msg);
      }
    },
    currentChange(val) {
      this.pageParam.current = val;
      if (this.keyWord) {
        this.searchSchool();
      } else {
        this.getSchoolList(this.pageParam);
      }
    },
    async searchSchool(current) {
      if (current) {
        this.pageParam.current = current;
      }
      const result = await reqSearchSchool({
        text: this.keyWord,
        current: this.pageParam.current,
        size: this.pageParam.size,
        uid: this.$store.state.user.userInfo.userId,
      });
      if (result.data.code === 200) {
        this.schoolList = result.data.data.schoolVoList;
        this.pages = result.data.data.pages;
        this.total = result.data.data.total;
        this.loading = false;
      } else {
        this.$message.error("系统异常~ " + result.data.msg);
      }
    },
  },
  mounted() {
    this.getSchoolList(this.pageParam);
  },
  watch: {
    keyWord() {
      this.searchSchool(1);
    },
  },
};
</script>

<style scoped>
.el-pagination {
  margin: 20px auto;
}
.MaterialInput{
  width: 238px;
  height: 40px;
  margin: 6px;
}
.elRow {
  margin: 20px 30px;
  border-radius: 4px;
  align-items: center;
  justify-content: center;
}
.elCol {
  margin: 5px;
}
.elCard {
}
.elCard img {
  height: 100px;
  width: 96px;
  float: left;
  padding: 5px;
  margin: 0 10px 0 -13px;
}
.elCard a {
  font-size: 25px;
  font-weight: bold;
  color: black;
  text-decoration: none;
  margin: -5px 0 5px 0;
  display: block;
}
.elCard a:hover {
  color: #4cb9fc;
}
.elCard div {
  font-size: 16px;
}
</style>
